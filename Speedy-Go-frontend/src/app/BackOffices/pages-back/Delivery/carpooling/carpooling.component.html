<div class="container-fluid shipping-dashboard py-4">
  <!-- Header Section -->
  <div class="dashboard-header mb-4">
    <div class="row align-items-center">
      <div class="col">
        <small class="d-inline-block fw-bold text-dark text-uppercase bg-light border border-primary rounded-pill px-4 py-1 mb-3">Carpooling</small>
        <h1 class="dashboard-title">Carpooling Management</h1>
      </div>
      <div class="col-auto">
        <button class="btn btn-primary rounded-pill px-4 py-2" (click)="showForm = !showForm">
          <i class="fa" [class.fa-minus]="showForm" [class.fa-plus]="!showForm"></i>
          {{ showForm ? 'Hide Form' : 'Add New Carpooling' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row stats-cards mb-4">
    <div class="col-md-4">
      <div class="card stat-card">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-auto">
              <div class="stat-icon bg-primary">
                <i class="fas fa-car"></i>
              </div>
            </div>
            <div class="col">
              <h6 class="stat-title">Total Rides</h6>
              <h3 class="stat-value">{{totalRides || 0}}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stat-card">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-auto">
              <div class="stat-icon bg-success">
                <i class="fas fa-dollar-sign"></i>
              </div>
            </div>
            <div class="col">
              <h6 class="stat-title">Total Earnings</h6>
              <h3 class="stat-value">{{totalEarnings || 0 | priceFormatter}}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stat-card">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-auto">
              <div class="stat-icon bg-warning">
                <i class="fas fa-users"></i>
              </div>
            </div>
            <div class="col">
              <h6 class="stat-title">Total Passengers</h6>
              <h3 class="stat-value">{{totalPassengers || 0}}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Carpooling Form -->
  <div class="card mb-4 service-card" *ngIf="showForm">
    <div class="card-header bg-light">
      <h5 class="mb-0">{{ isEditing ? 'Edit Carpooling' : 'Create Carpooling' }}</h5>
    </div>
    
    <form [formGroup]="carpoolingForm" (ngSubmit)="onSubmit()" class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Departure Location</label>
          <select formControlName="departureLocation" 
                  class="form-select form-control p-3 border-primary bg-light">
            <option value="">Select Departure</option>
            <option *ngFor="let gov of gouvernorats" [value]="gov">{{gov}}</option>
          </select>
        </div>
        
        <div class="col-md-6">
          <label class="form-label">Destination</label>
          <select formControlName="destination" 
                  class="form-select form-control p-3 border-primary bg-light">
            <option value="">Select Destination</option>
            <option *ngFor="let gov of gouvernorats" [value]="gov">{{gov}}</option>
          </select>
        </div>
        
        <div class="col-md-6">
          <label class="form-label">Start Time</label>
          <input type="datetime-local" formControlName="startTime" 
                 class="form-control p-3 border-primary bg-light">
          <small class="text-muted">When will the trip start?</small>
        </div>

        <div class="col-md-6">
          <label class="form-label">Distance (km)</label>
          <input type="number" formControlName="distanceKm" 
                 class="form-control p-3 border-primary bg-light" readonly>
        </div>
        
        <div class="col-md-6">
          <label class="form-label">Duration (minutes)</label>
          <input type="number" formControlName="durationMinutes" 
                 class="form-control p-3 border-primary bg-light" readonly>
        </div>

        <div class="col-md-6">
          <label class="form-label">Vehicle Type</label>
          <select formControlName="vehicleType" 
                  class="form-select form-control p-3 border-primary bg-light">
            <option value="">Select Vehicle Type</option>
            <option *ngFor="let type of vehicleTypes" [value]="type">{{type}}</option>
          </select>
        </div>
        
        <div class="col-md-6">
          <label class="form-label">Fuel Type</label>
          <select formControlName="fuelType" 
                  class="form-select form-control p-3 border-primary bg-light">
            <option value="">Select Fuel Type</option>
            <option *ngFor="let type of fuelTypes" [value]="type">{{type}}</option>
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">Available Seats</label>
          <input type="number" formControlName="availableSeats" 
                 class="form-control p-3 border-primary bg-light">
        </div>
        
        <div class="col-md-6">
          <label class="form-label">Weather Type</label>
          <select formControlName="weatherType" 
                  class="form-select form-control p-3 border-primary bg-light">
            <option *ngFor="let type of weatherTypes" [value]="type">{{type}}</option>
          </select>
        </div>

        <div class="col-md-6">
          <div class="form-check form-switch mt-3">
            <input type="checkbox" formControlName="wifi" 
                   class="form-check-input" id="wifiCheck" [value]="1">
            <label class="form-check-label" for="wifiCheck">Wifi Available</label>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="form-check form-switch mt-3">
            <input type="checkbox" formControlName="airConditioning" 
                   class="form-check-input" id="acCheck" [value]="1">
            <label class="form-check-label" for="acCheck">Air Conditioning</label>
          </div>
        </div>

        <div class="col-12">
          <label class="form-label">Description</label>
          <textarea formControlName="description" 
                    class="form-control p-3 border-primary bg-light" rows="3"></textarea>
        </div>

        <!-- Price Calculation -->
        <div class="col-12">
          <button type="button" 
                  class="btn btn-secondary rounded-pill px-4 py-2" 
                  (click)="calculatePrice()" 
                  [disabled]="carpoolingForm.invalid">
            <i class="fas fa-calculator me-2"></i>Calculate Price
          </button>
          
          <div *ngIf="calculatedPrice !== null" class="mt-3 p-3 badge badge-success">
            <h4 class="mb-0">Calculated Price: {{ calculatedPrice | priceFormatter }}</h4>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="col-12 d-flex justify-content-between mt-4 card-footer">
          <button type="submit" 
                  class="btn btn-primary rounded-pill px-4 py-2" 
                  [disabled]="carpoolingForm.invalid || calculatedPrice === null">
            <i class="fas" [class.fa-save]="isEditing" [class.fa-plus]="!isEditing"></i>
            {{ isEditing ? 'Update' : 'Create' }} Carpooling
          </button>
          
          <button type="button" 
                  class="btn btn-outline-secondary rounded-pill px-4 py-2" 
                  (click)="resetForm()">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- Carpoolings List -->
  <div class="card service-card">
    <div class="card-header bg-light">
      <h5 class="mb-0">Available Carpoolings</h5>
    </div>
    
    <div class="card-body table-responsive">
      <table class="table table-hover" *ngIf="carpoolings.length > 0">
        <thead class="table-primary">
          <tr>
            <th>Departure</th>
            <th>Destination</th>
            <th>Start Time</th>
            <th>Distance (km)</th>
            <th>Duration (min)</th>
            <th>Vehicle</th>
            <th>Seats</th>
            <th>Price/Seat</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let carpooling of carpoolings">
            <td>{{ carpooling.departureLocation }}</td>
            <td>{{ carpooling.destination }}</td>
            <td>{{ carpooling.startTime | date:'short' }}</td>
            <td>{{ carpooling.distanceKm }}</td>
            <td>{{ carpooling.durationMinutes }}</td>
            <td>{{ carpooling.vehicleType }}</td>
            <td>{{ carpooling.availableSeats }}</td>
            <td>{{ carpooling.pricePerSeat | priceFormatter }}</td>
            <td>
              <span class="badge" 
                    [class.badge-success]="carpooling.status === 'ACCEPTED'"
                    [class.badge-warning]="carpooling.status === 'PENDING'"
                    [class.badge-danger]="carpooling.status === 'CANCELLED'">
                {{ carpooling.status }}
              </span>
            </td>
            <td>
              <div class="btn-group">
                <button class="btn btn-sm btn-primary me-1" (click)="editCarpooling(carpooling)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteCarpooling(carpooling.carpoolingId)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="carpoolings.length === 0" class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>No carpoolings found. Create a new one!
      </div>
    </div>
  </div>
</div>