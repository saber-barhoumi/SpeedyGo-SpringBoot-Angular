<div class="container my-5">
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="text-primary">Place Shipping Order</h2>
      <p class="text-muted">Complete the form below to place your international shipping order</p>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ error }}
    <button type="button" class="btn-close" (click)="error = ''"></button>
  </div>

  <div *ngIf="loading" class="d-flex justify-content-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div class="row" *ngIf="!loading">
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Selected Service</h5>
        </div>
        <div class="card-body" *ngIf="service">
          <h5 class="card-title">{{ service.deliveryPersonName }}</h5>
          <p class="text-muted mb-3">International Shipping Provider</p>

          <div class="mb-3">
            <h6 class="text-muted">Countries Served</h6>
            <p>{{ service.countriesServed?.join(', ') || 'None specified' }}</p>
          </div>

          <div class="mb-3">
            <h6 class="text-muted">Accepted Items</h6>
            <p>{{ service.acceptedGoodTypes?.join(', ') || 'None specified' }}</p>
          </div>

          <div class="row mb-3">
            <div class="col-6">
              <h6 class="text-muted">Base Price</h6>
              <p class="mb-0">{{ service.basePrice | currency }}</p>
            </div>
            <div class="col-6">
              <h6 class="text-muted">Price per kg</h6>
              <p class="mb-0">{{ service.pricePerKg | currency }}/kg</p>
            </div>
          </div>

          <div class="alert alert-info">
            <p class="mb-0"><strong>Maximum Weight:</strong> {{ service.maxWeightPerOrder }} kg</p>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <form [formGroup]="orderForm" (ngSubmit)="onSubmit()">

            <div class="mb-3">
              <label for="destinationCountry" class="form-label">Destination Country *</label>
              <select
                id="destinationCountry"
                formControlName="destinationCountry"
                class="form-select"
                [class.is-invalid]="orderForm.get('destinationCountry')?.invalid && orderForm.get('destinationCountry')?.touched">
                <option value="">Select a country</option>
                <option *ngFor="let country of countriesList" [value]="country">
                  {{ country }}
                </option>
              </select>
              <div class="invalid-feedback"
                *ngIf="orderForm.get('destinationCountry')?.invalid && orderForm.get('destinationCountry')?.touched">
                Please select a destination country
              </div>
            </div>

            <div class="mb-3">
              <label for="destinationAddress" class="form-label">Detailed Destination Address *</label>
              <textarea
                id="destinationAddress"
                formControlName="destinationAddress"
                class="form-control"
                rows="4"
                placeholder="Enter full delivery address including street, city, postal code"
                [class.is-invalid]="orderForm.get('destinationAddress')?.invalid && orderForm.get('destinationAddress')?.touched">
              </textarea>
              <div class="invalid-feedback"
                *ngIf="orderForm.get('destinationAddress')?.errors?.['required'] && orderForm.get('destinationAddress')?.touched">
                Destination address is required
              </div>
              <div class="invalid-feedback"
                *ngIf="orderForm.get('destinationAddress')?.errors?.['minlength'] && orderForm.get('destinationAddress')?.touched">
                Address must be at least 10 characters long
              </div>
              <div class="text-muted small mt-1">
                Min 10 characters, include street, city, and postal code
              </div>
            </div>

            <div class="mb-3">
              <label for="packageWeight" class="form-label">Package Weight (kg) *</label>
              <input
                type="number"
                id="packageWeight"
                formControlName="packageWeight"
                class="form-control"
                step="0.1"
                min="0.1"
                max="{{ service?.maxWeightPerOrder }}"
                placeholder="Enter package weight"
                [class.is-invalid]="orderForm.get('packageWeight')?.invalid && orderForm.get('packageWeight')?.touched">
              <div class="invalid-feedback"
                *ngIf="orderForm.get('packageWeight')?.errors?.['required'] && orderForm.get('packageWeight')?.touched">
                Package weight is required
              </div>
              <div class="invalid-feedback" *ngIf="orderForm.get('packageWeight')?.errors?.['min']">
                Weight must be greater than 0
              </div>
              <div class="invalid-feedback" *ngIf="orderForm.get('packageWeight')?.errors?.['max']">
                Weight exceeds maximum allowed ({{ service?.maxWeightPerOrder }} kg)
              </div>
            </div>

            <!-- Item Type -->
            <div class="mb-3">
              <label for="itemType" class="form-label">Item Type *</label>
              <select
                id="itemType"
                formControlName="itemType"
                class="form-select"
                [class.is-invalid]="orderForm.get('itemType')?.invalid && orderForm.get('itemType')?.touched">
                <option value="">Select item type</option>
                <option *ngFor="let type of goodTypesList" [value]="type">
                  {{ type }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="orderForm.get('itemType')?.invalid && orderForm.get('itemType')?.touched">
                Please select an item type
              </div>
            </div>

            <!-- Item Description -->
            <div class="mb-3">
              <label for="itemDescription" class="form-label">Item Description *</label>
              <textarea
                id="itemDescription"
                formControlName="itemDescription"
                class="form-control"
                rows="3"
                placeholder="Describe the items you are shipping"
                [class.is-invalid]="orderForm.get('itemDescription')?.invalid && orderForm.get('itemDescription')?.touched">
              </textarea>
              <div class="invalid-feedback"
                *ngIf="orderForm.get('itemDescription')?.errors?.['required'] && orderForm.get('itemDescription')?.touched">
                Item description is required
              </div>
              <div class="invalid-feedback"
                *ngIf="orderForm.get('itemDescription')?.errors?.['minlength'] && orderForm.get('itemDescription')?.touched">
                Description must be at least 20 characters
              </div>
              <div class="text-muted small mt-1">
                Min 20 characters, max 500 characters
              </div>
            </div>

            <!-- Item Photo -->
            <div class="mb-3">
              <label for="itemPhoto" class="form-label">Item Photo (Optional)</label>
              <input
                type="file"
                id="itemPhoto"
                class="form-control"
                (change)="onFileSelected($event)"
                accept="image/*">
              <div class="text-muted small mt-1">
                Max size: 5MB. Supported formats: JPG, PNG
              </div>

              <div *ngIf="imagePreview" class="mt-3">
                <img [src]="imagePreview" class="img-thumbnail" alt="Item preview" style="max-height: 200px;">
              </div>
            </div>

            <div *ngIf="estimatedCost" class="mb-3">
              <div class="alert alert-success">
                <strong>Estimated Shipping Cost:</strong>
                {{ estimatedCost | currency }}
              </div>
            </div>

            <div class="d-grid">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="orderForm.invalid">
                Place Shipping Order
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>