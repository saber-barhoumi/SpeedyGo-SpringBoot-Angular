<div class="livraison-form-container">
    <div class="header">
      <h1>{{ isEditMode ? 'Edit Livraison' : 'Create New Livraison' }}</h1>
      <button class="btn btn-secondary" (click)="cancel()">
        <i class="fas fa-arrow-left"></i> Back to List
      </button>
    </div>
  
    <div class="loading-container" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading data...</p>
    </div>
  
    <form [formGroup]="livraisonForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
      <div class="form-section">
        <h2>Basic Information</h2>
        <div class="form-group">
          <label for="title">Title <span class="required">*</span></label>
          <input 
            type="text" 
            id="title" 
            class="form-control" 
            formControlName="title" 
            placeholder="Enter livraison title"
            [ngClass]="{'is-invalid': isFieldInvalid('title')}">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('title')">
            {{ getErrorMessage('title') }}
          </div>
        </div>
  
        <div class="form-group">
          <label for="description">Description</label>
          <textarea 
            id="description" 
            class="form-control" 
            formControlName="description" 
            rows="3" 
            placeholder="Enter a description"></textarea>
        </div>
      </div>
  
      <div class="form-section">
        <h2>Origin & Destination</h2>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="originAddress">Origin Address <span class="required">*</span></label>
            <input 
              type="text" 
              id="originAddress" 
              class="form-control" 
              formControlName="originAddress" 
              placeholder="Enter pickup address"
              [ngClass]="{'is-invalid': isFieldInvalid('originAddress')}">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('originAddress')">
              {{ getErrorMessage('originAddress') }}
            </div>
          </div>
  
          <div class="form-group col-md-6">
            <label for="destinationAddress">Destination Address <span class="required">*</span></label>
            <input 
              type="text" 
              id="destinationAddress" 
              class="form-control" 
              formControlName="destinationAddress" 
              placeholder="Enter delivery address"
              [ngClass]="{'is-invalid': isFieldInvalid('destinationAddress')}">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('destinationAddress')">
              {{ getErrorMessage('destinationAddress') }}
            </div>
          </div>
        </div>
  
        <div class="form-group">
          <label for="distanceInKm">Distance (km)</label>
          <input 
            type="number" 
            id="distanceInKm" 
            class="form-control" 
            formControlName="distanceInKm" 
            placeholder="Enter distance in kilometers"
            [ngClass]="{'is-invalid': isFieldInvalid('distanceInKm')}">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('distanceInKm')">
            {{ getErrorMessage('distanceInKm') }}
          </div>
        </div>
      </div>
  
      <div class="form-section">
        <h2>Package Details</h2>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="packageWeightKg">Weight (kg)</label>
            <input 
              type="number" 
              id="packageWeightKg" 
              class="form-control" 
              formControlName="packageWeightKg" 
              placeholder="Enter weight in kilograms"
              [ngClass]="{'is-invalid': isFieldInvalid('packageWeightKg')}">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('packageWeightKg')">
              {{ getErrorMessage('packageWeightKg') }}
            </div>
          </div>
  
          <div class="form-group col-md-6">
            <label for="packageDimensions">Dimensions</label>
            <input 
              type="text" 
              id="packageDimensions" 
              class="form-control" 
              formControlName="packageDimensions" 
              placeholder="Format: length x width x height (cm)">
          </div>
        </div>
  
        <div class="form-check">
          <input 
            type="checkbox" 
            id="requiresRefrigeration" 
            class="form-check-input" 
            formControlName="requiresRefrigeration">
          <label class="form-check-label" for="requiresRefrigeration">Requires refrigeration</label>
        </div>
      </div>
  
      <div class="form-section">
        <h2>Schedule</h2>
        <div class="form-row">
            <!-- In your form, update the datetime inputs to include the step attribute for seconds -->
        <div class="form-group col-md-6">
            <label for="scheduledPickupTime">Scheduled Pickup Time <span class="required">*</span></label>
            <input 
            type="datetime-local" 
            id="scheduledPickupTime" 
            class="form-control" 
            formControlName="scheduledPickupTime"
            step="1" 
            [ngClass]="{'is-invalid': isFieldInvalid('scheduledPickupTime')}">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('scheduledPickupTime')">
            {{ getErrorMessage('scheduledPickupTime') }}
            </div>
        </div>
        
        <div class="form-group col-md-6">
            <label for="scheduledDeliveryTime">Scheduled Delivery Time <span class="required">*</span></label>
            <input 
            type="datetime-local" 
            id="scheduledDeliveryTime" 
            class="form-control" 
            formControlName="scheduledDeliveryTime"
            step="1" 
            [ngClass]="{'is-invalid': isFieldInvalid('scheduledDeliveryTime')}">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('scheduledDeliveryTime')">
            {{ getErrorMessage('scheduledDeliveryTime') }}
            </div>
        </div>
        
        <!-- Same for the actual delivery time if it's editable -->
        <div class="form-group" *ngIf="isEditMode">
            <label for="actualDeliveryTime">Actual Delivery Time</label>
            <input 
            type="datetime-local" 
            id="actualDeliveryTime" 
            class="form-control" 
            formControlName="actualDeliveryTime"
            step="1">
        </div>
        </div>
      </div>
  
      <div class="form-section" *ngIf="isEditMode">
        <h2>Status & Vehicle Assignment</h2>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="status">Status</label>
            <select id="status" class="form-control" formControlName="status">
              <option *ngFor="let status of statuses" [value]="status">
                {{ status.replace('_', ' ') }}
              </option>
            </select>
          </div>
  
          <div class="form-group col-md-6">
            <label for="assignedVehicleId">Assigned Vehicle</label>
            <select id="assignedVehicleId" class="form-control" formControlName="assignedVehicleId">
              <option [value]="null">None</option>
              <option *ngFor="let vehicle of availableVehicles" [value]="vehicle.vehicleId">
                {{ vehicle.brand }} {{ vehicle.model }} - {{ vehicle.licensePlate }}
                <span *ngIf="vehicle.hasRefrigeration"> (Refrigerated)</span>
              </option>
            </select>
          </div>
        </div>
      </div>
  
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
        
        <div class="action-buttons">
          <button 
            *ngIf="!isEditMode" 
            type="button" 
            class="btn btn-info" 
            (click)="useAiSuggestion()" 
            [disabled]="submitting">
            <i class="fas fa-magic"></i>
            Create with AI Vehicle Selection
          </button>
          
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="submitting">
            {{ isEditMode ? 'Update' : 'Create' }}
            <i class="fas fa-{{ isEditMode ? 'check' : 'plus' }}"></i>
          </button>
        </div>
      </div>
  
      <div class="progress" *ngIf="submitting">
        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
      </div>
    </form>
  </div>